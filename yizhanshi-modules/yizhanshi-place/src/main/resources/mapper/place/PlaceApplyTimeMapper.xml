<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yizhanshi.place.mapper.PlaceApplyTimeMapper">

    <resultMap type="com.yizhanshi.place.api.domain.PlaceApplyTime" id="PlaceApplyTimeResult">
        <id     property="applyTimeId"       column="apply_time_id"      />
        <result property="placeId"        column="place_id"        />
        <result property="applyDay"        column="apply_day"        />
        <result property="timeStartId"        column="time_start_id"        />
        <result property="applyStartTime"        column="apply_start_time"        />
        <result property="timeEndId"        column="time_end_id"        />
        <result property="applyEndTime"        column="apply_end_time"        />
        <result property="status"     column="status"    />
        <result property="delFlag"     column="del_flag"    />
        <result property="createTime"     column="create_time"    />
        <result property="createBy"     column="create_by"    />
        <result property="updateTime"     column="update_time"    />
        <result property="updateBy"     column="update_by"    />
        <result property="remark"     column="remark"    />
        <collection  property="place"   javaType="com.yizhanshi.place.api.domain.Place"  resultMap="PlaceResult" />
    </resultMap>
    <resultMap id="PlaceResult" type="com.yizhanshi.place.api.domain.Place">
        <id     property="placeId"       column="place_id"        />
        <result property="placeName"     column="place_name"      />
        <result property="placeCampus"      column="place_campus"       />
        <result property="placeCapacity"     column="place_capacity"      />
    </resultMap>
    <sql id="selectPlaceApplyTimeVo">
        select pa.apply_time_id,pa.place_id, pa.apply_day,
        pa.time_start_id,pa.time_end_id,pa.apply_start_time,pa.apply_end_time,
        pa.status, pa.del_flag,pa.create_by, pa.create_time, pa.remark,
        p.place_id,p.place_name,p.place_campus,p.place_capacity
        from business_place_apply_time pa
        left join business_place p on pa.place_id=p.place_id
    </sql>
    <select id="selectPlaceApplyTimeList" parameterType="com.yizhanshi.place.api.domain.PlaceApplyTime" resultMap="PlaceApplyTimeResult">
       <include refid="selectPlaceApplyTimeVo"></include>
        where pa.del_flag = '0'
        <if test="applyTimeId != null and applyTimeId != 0">
            AND pa.apply_time_id = #{applyTimeId}
        </if>
        <if test="params.chooseDay != null and params.chooseDay  != ''">
            AND date_format(pa.apply_day,'%Y%m%d') = date_format(#{params.chooseDay},'%Y%m%d')
        </if>
        <if test="place!=null and place.placeName != null and place.placeName != ''">
            AND p.place_name like concat('%', #{place.placeName}, '%')
        </if>
        <if test="place!=null and place.placeCampus != null and place.placeCampus != ''">
            AND p.place_campus like concat('%', #{place.placeCampus}, '%')
        </if>
        <if test="status != null and status != ''">
            AND pa.status = #{status}
        </if>
        <if test="params.beginTime != null and params.beginTime != ''"><!-- 开始时间检索 -->
            AND date_format(pa.create_time,'%Y%m%d') &gt;= date_format(#{params.beginTime},'%Y%m%d')
        </if>
        <if test="params.endTime != null and params.endTime != ''"><!-- 结束时间检索 -->
            AND date_format(pa.create_time,'%Y%m%d')  &lt;= date_format(#{params.endTime},'%Y%m%d')
        </if>
    </select>
    <select id="selectPlaceApplyTimeByApplyTimeIds" parameterType="Long" resultMap="PlaceApplyTimeResult">
        <include refid="selectPlaceApplyTimeVo"></include>
        where pa.apply_time_id in
        <foreach item="applyTimeId" collection="array" open="(" separator="," close=")">
            #{applyTimeId}
        </foreach>
    </select>
    <select id="selectPlaceApplyTimeById" parameterType="Long" resultMap="PlaceApplyTimeResult">
        <include refid="selectPlaceApplyTimeVo"></include>
        where pa.apply_time_id = #{applyTimeId}
    </select>
    <select id="selectPlaceApplyTimeByIds"  resultMap="PlaceApplyTimeResult">
        <include refid="selectPlaceApplyTimeVo"></include>
        where pa.apply_time_id in
        <foreach item="applyTimeId" collection="array" open="(" separator="," close=")">
            #{applyTimeId}
        </foreach>
    </select>


    <update id="updatePlaceApplyTime" parameterType="com.yizhanshi.place.api.domain.PlaceApplyTime">
    update business_place_apply_time
    <set>
        <if test="placeId != null and placeId != 0">place_id=#{placeId},</if>
        <if test="applyDay != null">apply_day=#{applyDay,jdbcType=DATE},</if>
        <if test="timeStartId != null and timeStartId != 0">time_start_id=#{timeStartId},</if>
        <if test="timeEndId != null and timeEndId != 0">time_end_id=#{timeEndId},</if>
        <if test="applyStartTime != null and applyStartTime != ''">apply_start_time=#{applyStartTime},</if>
        <if test="applyEndTime != null and applyEndTime != ''">apply_end_time=#{applyEndTime},</if>
        <if test="status != null and status != ''">status=#{status},</if>
        <if test="updateBy != null and updateBy != ''">update_by=#{updateBy},</if>
        <if test="remark != null and remark != ''">remark=#{remark},</if>
        update_time = sysdate()
    </set>
        where apply_time_id = #{applyTimeId}
    </update>
    <delete id="deletePlaceApplyTime">
        update business_place_apply_time set del_flag = '2' where apply_time_id in
        <foreach collection="array" item="applyTimeId" open="(" separator="," close=")">
            #{applyTimeId}
        </foreach>
    </delete>
    <insert id="insertPlaceApplyTime" parameterType="com.yizhanshi.place.api.domain.PlaceApplyTime" useGeneratedKeys="true" keyProperty="applyTimeId">
        insert into business_place_apply_time(
            <if test="applyTimeId != null and applyTimeId != 0">apply_time_id,</if>
            apply_day,
            <if test="placeId != null and placeId != 0">place_id,</if>
            <if test="timeStartId != null and timeStartId != 0">time_start_id,</if>
            <if test="timeEndId != null and timeEndId != 0">time_end_id,</if>
            <if test="applyStartTime != null and applyStartTime != ''">apply_start_time,</if>
            <if test="applyEndTime != null and applyEndTime != ''">apply_end_time,</if>
            <if test="status != null and status != ''">status,</if>
            <if test="createBy != null and createBy != ''">create_by,</if>
            <if test="remark != null and remark != ''">remark,</if>
            create_time
        )values(
        <if test="applyTimeId != null and applyTimeId != 0">#{applyTimeId},</if>
        #{applyDay, jdbcType=DATE},
        <if test="placeId != null and placeId != 0">#{placeId},</if>
        <if test="timeStartId != null and timeStartId != 0">#{timeStartId},</if>
        <if test="timeEndId != null and timeEndId !=0">#{timeEndId},</if>
        <if test="applyStartTime != null and applyStartTime != ''">#{applyStartTime},</if>
        <if test="applyEndTime != null and applyEndTime != ''">#{applyEndTime},</if>
        <if test="status != null and status != ''">#{status},</if>
        <if test="createBy != null and createBy != ''">#{createBy},</if>
        <if test="remark != null and remark != ''">#{remark},</if>
        sysdate()
        )
    </insert>


    <select id="selectAllPlace" resultMap="PlaceApplyTimeResult">
        <include refid="selectPlaceApplyTimeVo"/>
        where pa.place_id  = #{placeId}
         AND date_format(pa.apply_day,'%Y%m%d') = date_format(#{chooseDay},'%Y%m%d') and pa.del_flag='0'
    </select>


</mapper>