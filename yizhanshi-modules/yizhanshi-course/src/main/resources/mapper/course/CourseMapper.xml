<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yizhanshi.course.mapper.CourseMapper">

    <resultMap type="com.yizhanshi.course.api.domain.Course" id="CourseResult">
        <id     property="courseId"       column="course_id"      />
        <result property="courseName"       column="course_name"      />
        <result property="courseDescription"     column="course_description"    />
        <result property="courseType"     column="course_type"    />
        <result property="teacherId"     column="teacher_id"    />
        <result property="courseDay"     column="course_day"    />
        <result property="timeStartId"     column="time_start_id"    />
        <result property="timeEndId"     column="time_end_id"    />
        <result property="courseStartTime"     column="course_start_time"    />
        <result property="courseEndTime"        column="course_end_time"        />
        <result property="placeId"        column="place_id"/>
        <result property="courseNumber"        column="course_number"/>
        <result property="chooseStatus"        column="choose_status"/>
        <result property="courseCheck"        column="course_check"/>
        <result property="status"     column="status"    />
        <result property="delFlag"     column="del_flag"    />
        <result property="createTime"     column="create_time"    />
        <result property="createBy"     column="create_by"    />
        <result property="updateTime"     column="update_time"    />
        <result property="updateBy"     column="update_by"    />
        <result property="remark"     column="remark"    />
        <collection  property="teachers"   javaType="com.yizhanshi.course.api.domain.Teacher"  resultMap="TeacherResult" />
        <collection  property="places"   javaType="com.yizhanshi.place.api.domain.Place"  resultMap="PlaceResult" />
    </resultMap>

    <resultMap id="TeacherResult" type="com.yizhanshi.course.api.domain.Teacher">
        <id     property="teacherId"       column="teacher_id"        />
        <result property="teacherName"     column="teacher_name"      />
        <result property="teacherUserStudentid"      column="teacher_userStudentid"      />
        <result property="status"      column="status"      />
    </resultMap>
    <resultMap id="PlaceResult" type="com.yizhanshi.place.api.domain.Place">
        <id     property="placeId"       column="place_id"        />
        <result property="placeName"     column="place_name"      />
        <result property="placeCampus"      column="place_campus"       />
        <result property="placeCapacity"     column="place_capacity"      />
        <result property="status"       column="status"    />
    </resultMap>
    <sql id="selectCourseVo">
        select c.course_id, c.course_name, c.course_description, c.teacher_id, c.course_day,
        c.time_start_id, c.time_end_id, c.course_start_time, c.course_end_time, c.place_id,
        c.course_number, c.choose_status, c.course_type,
        c.status, c.del_flag,c.create_by, c.create_time, c.remark,
        p.place_id,p.place_name,p.place_campus,p.place_capacity,p.status,
        t.teacher_id,t.teacher_name,t.teacher_userStudentid,t.status
        from business_course c
        left join business_place p on c.place_id=p.place_id
        left join business_teacher t on c.teacher_id=t.teacher_id
    </sql>
    <select id="selectCourseList" parameterType="com.yizhanshi.course.api.domain.Course" resultMap="CourseResult">
        <include refid="selectCourseVo" />
        where c.del_flag = '0'
        <if test="courseId != null and courseId != 0">
            AND c.course_id = #{courseId}
        </if>
        <if test="courseName != null and courseName != ''">
            AND c.course_name like concat('%', #{courseName}, '%')
        </if>
        <if test="courseType != null and courseType != ''">
            AND c.course_type like concat('%', #{courseType}, '%')
        </if>
        <if test="teachers!=null and teachers.teacherName != null and teachers.teacherName != ''">
            AND t.teacher_name like concat('%', #{teachers.teacherName}, '%')
        </if>
        <if test="places!=null and places.placeName != null and places.placeName != ''">
            AND p.place_name like concat('%', #{places.placeName}, '%')
        </if>
        <if test="status != null and status != ''">
            AND c.status = #{status}
        </if>
        <if test="params.chooseDay != null and params.chooseDay  != ''">
            AND date_format(c.course_day,'%Y%m%d') = date_format(#{params.chooseDay},'%Y%m%d')
        </if>
        <if test="params.beginTime != null and params.beginTime != ''"><!-- 开始时间检索 -->
            AND date_format(c.create_time,'%Y%m%d') &gt;= date_format(#{params.beginTime},'%Y%m%d')
        </if>
        <if test="params.endTime != null and params.endTime != ''"><!-- 结束时间检索 -->
            AND date_format(c.create_time,'%Y%m%d') &lt;= date_format(#{params.endTime},'%Y%m%d')
        </if>
    </select>
    <select id="selectCourseById" parameterType="Long" resultMap="CourseResult">
        <include refid="selectCourseVo">
        </include>
        where c.course_id=#{courseId}
    </select>

    <insert id="insertCourse" parameterType="com.yizhanshi.course.api.domain.Course" useGeneratedKeys="true" keyProperty="courseId">
        insert into business_course (
        <if test="courseId != null and courseId != 0">course_id,</if>
        <if test="courseName != null and courseName != ''">course_name,</if>
        <if test="courseDescription != null and courseDescription != ''">course_description,</if>
        <if test="courseType != null and courseType != ''">course_type,</if>
        <if test="teacherId != null and teacherId != 0">teacher_id,</if>
        course_day,
        <if test="timeStartId != null and timeStartId != 0">time_start_id,</if>
        <if test="timeEndId != null and timeEndId != 0">time_end_id,</if>
        <if test="courseStartTime != null and courseStartTime != ''">course_start_time,</if>
        <if test="courseEndTime != null and courseEndTime != ''">course_end_time,</if>
        <if test="placeId != null and placeId != 0">place_id,</if>
        <if test="courseNumber != null and courseNumber != 0">course_number,</if>
        <if test="chooseStatus != null and chooseStatus != ''">choose_status,</if>
        <if test="courseCheck != null and courseCheck != ''">course_check,</if>
        <if test="status != null and status != ''">status,</if>
        <if test="createBy != null and createBy != ''">create_by,</if>
        <if test="remark != null and remark != ''">remark,</if>
        create_time
        )values(
        <if test="courseId != null and courseId != 0">#{courseId},</if>
        <if test="courseName != null and courseName != ''">#{courseName},</if>
        <if test="courseDescription != null and courseDescription != ''">#{courseDescription},</if>
        <if test="courseType != null and courseType != ''">#{courseType},</if>
        <if test="teacherId != null and teacherId != 0">#{teacherId},</if>
        #{courseDay, jdbcType=DATE},
        <if test="timeStartId != null and timeStartId != 0">#{timeStartId},</if>
        <if test="timeEndId != null and timeEndId != 0">#{timeEndId},</if>
        <if test="courseStartTime != null and courseStartTime != ''">#{courseStartTime},</if>
        <if test="courseEndTime != null and courseEndTime != ''">#{courseEndTime},</if>
        <if test="placeId != null and placeId != 0">#{placeId},</if>
        <if test="courseNumber != null and courseNumber != 0">#{courseNumber},</if>
        <if test="chooseStatus != null and chooseStatus != ''">#{chooseStatus},</if>
        <if test="courseCheck != null and courseCheck != ''">#{courseCheck},</if>
        <if test="status != null and status != ''">#{status},</if>
        <if test="createBy != null and createBy != ''">#{createBy},</if>
        <if test="remark != null and remark != ''">#{remark},</if>
        sysdate()
        )
    </insert>

    <update id="updateCourse" parameterType="com.yizhanshi.course.api.domain.Course">
        update business_course
        <set>
            <if test="courseName != null and courseName != ''">course_name=#{courseName},</if>
            <if test="courseDescription != null and courseDescription != ''">course_description=#{courseDescription},</if>
            <if test="courseType != null and courseType != ''">course_type=#{courseType},</if>
            <if test="teacherId != null and teacherId != 0">teacher_id=#{teacherId},</if>
            <if test="courseDay != null ">course_day=#{courseDay,jdbcType=DATE},</if>
            <if test="timeStartId != null and timeStartId != 0">time_start_id=#{timeStartId},</if>
            <if test="timeEndId != null and timeEndId != 0">time_end_id=#{timeEndId},</if>
            <if test="courseStartTime != null and courseStartTime != ''">course_start_time=#{courseStartTime},</if>
            <if test="courseEndTime != null and courseEndTime != ''">course_end_time=#{courseEndTime},</if>
            <if test="placeId != null and placeId != 0">place_id=#{placeId},</if>
            <if test="courseNumber != null and courseNumber != 0">course_number=#{courseNumber},</if>
            <if test="chooseStatus != null and chooseStatus != ''">choose_status=#{chooseStatus},</if>
            <if test="courseCheck != null and courseCheck != ''">course_check=#{courseCheck},</if>
            <if test="chooseStatus != null and chooseStatus != ''">choose_status=#{chooseStatus},</if>
            <if test="status != null and status != ''">status=#{status},</if>
            <if test="updateBy != null and updateBy != ''">update_by=#{updateBy},</if>
            <if test="remark != null and remark != ''">remark=#{remark},</if>
            update_time = sysdate()
        </set>
        where course_id = #{courseId}
    </update>
    <delete id="deleteCourse" parameterType="Long">
        update business_course set del_flag = '2' where course_id in
        <foreach collection="array" item="courseId" open="(" separator="," close=")">
            #{courseId}
        </foreach>
    </delete>
    <select id="selectAllCourse" resultMap="CourseResult">
        <include refid="selectCourseVo"/>
        where c.place_id  = #{placeId}
        AND date_format(c.course_day,'%Y%m%d') = date_format(#{chooseDay},'%Y%m%d')
    </select>


</mapper>