<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yizhanshi.course.mapper.CourseMapper">

    <resultMap type="com.yizhanshi.course.api.domain.Course" id="CourseResult">
        <id     property="courseId"       column="course_id"      />
        <result property="courseName"       column="course_name"      />
        <result property="courseDescription"     column="course_description"    />
        <result property="courseType"     column="course_type"    />
        <result property="teacherId"     column="teacher_id"    />
        <result property="courseNumber"        column="course_number"/>
        <result property="courseCheck"        column="course_check"/>
        <result property="status"     column="status"    />
        <result property="delFlag"     column="del_flag"    />
        <result property="createTime"     column="create_time"    />
        <result property="createBy"     column="create_by"    />
        <result property="updateTime"     column="update_time"    />
        <result property="updateBy"     column="update_by"    />
        <result property="remark"     column="remark"    />
        <collection  property="teacher"   javaType="com.yizhanshi.course.api.domain.Teacher"  resultMap="TeacherResult" />
    </resultMap>

    <resultMap type="com.yizhanshi.course.api.domain.Teacher" id="TeacherResult">
        <id     property="teacherId"       column="teacher_id"      />
        <result property="teacherName"     column="teacher_name"    />
        <result property="teacherSex"     column="teacher_sex"    />
        <result property="teacherAge"     column="teacher_age"    />
        <result property="teacherStudentid"       column="teacher_studentid"      />
        <result property="teacherDescription"     column="teacher_description"    />
        <result property="teacherPicture"     column="teacher_picture"    />
        <result property="teacherEmail"     column="teacher_email"    />
        <result property="teacherPhone"     column="teacher_phone"    />
        <result property="teacherQq"     column="teacher_qq"    />
        <result property="teacherWechat"     column="teacher_wechat"    />
    </resultMap>
    <sql id="selectCourseVo">
        select c.course_id, c.course_name, c.course_description,c.course_type, c.teacher_id,
        c.course_number,  c.course_check,
        c.status, c.del_flag,c.create_by, c.create_time,c.update_time,c.update_by, c.remark,
        t.teacher_id, t.teacher_name, t.teacher_sex,t.teacher_age,t.teacher_studentid,t.teacher_description,
        t.teacher_picture,t.teacher_email,t.teacher_phone,t.teacher_qq,t.teacher_wechat
        from business_course c
        left join business_teacher t on c.teacher_id=t.teacher_id
    </sql>
    <select id="selectCourseList" parameterType="com.yizhanshi.course.api.domain.Course" resultMap="CourseResult">
        <include refid="selectCourseVo" />
        where c.del_flag = '0'
        <if test="courseId != null and courseId != 0">
            AND c.course_id = #{courseId}
        </if>
        <if test="courseName != null and courseName != ''">
            AND c.course_name like concat('%', #{courseName}, '%')
        </if>
        <if test="courseType != null and courseType != ''">
            AND c.course_type like concat('%', #{courseType}, '%')
        </if>
        <if test="teacher!=null and teacher.teacherName != null and teacher.teacherName != ''">
            AND t.teacher_name like concat('%', #{teacher.teacherName}, '%')
        </if>
        <if test="teacher!=null and teacher.teacherStudentid != null and teacher.teacherStudentid != ''">
            AND t.teacher_studentid like concat('%', #{teacher.teacherStudentid}, '%')
        </if>
        <if test="status != null and status != ''">
            AND c.status = #{status}
        </if>
        <if test="params.beginTime != null and params.beginTime != ''"><!-- 开始时间检索 -->
            AND date_format(c.create_time,'%Y%m%d') &gt;= date_format(#{params.beginTime},'%Y%m%d')
        </if>
        <if test="params.endTime != null and params.endTime != ''"><!-- 结束时间检索 -->
            AND date_format(c.create_time,'%Y%m%d') &lt;= date_format(#{params.endTime},'%Y%m%d')
        </if>
    </select>
    <select id="selectCourseById" parameterType="Long" resultMap="CourseResult">
        <include refid="selectCourseVo">
        </include>
        where c.course_id=#{courseId}
    </select>

    <insert id="insertCourse" parameterType="com.yizhanshi.course.api.domain.Course" useGeneratedKeys="true" keyProperty="courseId">
        insert into business_course (
        <if test="courseId != null and courseId != 0">course_id,</if>
        <if test="courseName != null and courseName != ''">course_name,</if>
        <if test="courseDescription != null and courseDescription != ''">course_description,</if>
        <if test="courseType != null and courseType != ''">course_type,</if>
        <if test="teacherId != null and teacherId != 0">teacher_id,</if>
        <if test="courseNumber != null and courseNumber != 0">course_number,</if>
        <if test="chooseStatus != null and chooseStatus != ''">choose_status,</if>
        <if test="courseCheck != null and courseCheck != ''">course_check,</if>
        <if test="status != null and status != ''">status,</if>
        <if test="createBy != null and createBy != ''">create_by,</if>
        <if test="remark != null and remark != ''">remark,</if>
        create_time
        )values(
        <if test="courseId != null and courseId != 0">#{courseId},</if>
        <if test="courseName != null and courseName != ''">#{courseName},</if>
        <if test="courseDescription != null and courseDescription != ''">#{courseDescription},</if>
        <if test="courseType != null and courseType != ''">#{courseType},</if>
        <if test="teacherId != null and teacherId != 0">#{teacherId},</if>
        <if test="courseNumber != null and courseNumber != 0">#{courseNumber},</if>
        <if test="chooseStatus != null and chooseStatus != ''">#{chooseStatus},</if>
        <if test="courseCheck != null and courseCheck != ''">#{courseCheck},</if>
        <if test="status != null and status != ''">#{status},</if>
        <if test="createBy != null and createBy != ''">#{createBy},</if>
        <if test="remark != null and remark != ''">#{remark},</if>
        sysdate()
        )
    </insert>

    <update id="updateCourse" parameterType="com.yizhanshi.course.api.domain.Course">
        update business_course
        <set>
            <if test="courseName != null and courseName != ''">course_name=#{courseName},</if>
            <if test="courseDescription != null and courseDescription != ''">course_description=#{courseDescription},</if>
            <if test="courseType != null and courseType != ''">course_type=#{courseType},</if>
            <if test="teacherId != null and teacherId != 0">teacher_id=#{teacherId},</if>
            <if test="courseNumber != null and courseNumber != 0">course_number=#{courseNumber},</if>
            <if test="chooseStatus != null and chooseStatus != ''">choose_status=#{chooseStatus},</if>
            <if test="courseCheck != null and courseCheck != ''">course_check=#{courseCheck},</if>
            <if test="chooseStatus != null and chooseStatus != ''">choose_status=#{chooseStatus},</if>
            <if test="status != null and status != ''">status=#{status},</if>
            <if test="updateBy != null and updateBy != ''">update_by=#{updateBy},</if>
            <if test="remark != null and remark != ''">remark=#{remark},</if>
            update_time = sysdate()
        </set>
        where course_id = #{courseId}
    </update>
    <delete id="deleteCourse" parameterType="Long">
        update business_course set del_flag = '2' where course_id in
        <foreach collection="array" item="courseId" open="(" separator="," close=")">
            #{courseId}
        </foreach>
    </delete>



</mapper>