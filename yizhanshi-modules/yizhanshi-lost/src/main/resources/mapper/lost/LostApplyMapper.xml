<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yizhanshi.lost.mapper.LostApplyMapper">

    <resultMap type="com.yizhanshi.lost.domain.LostApply" id="LostApplyResult">
        <id     property="applyId"       column="apply_id"      />
        <result property="applyName"       column="apply_name"      />
        <result property="userStudentid"       column="user_studentid"      />
        <result property="applyContent"     column="apply_content"    />
        <result property="lostId"     column="lost_id"    />
        <result property="refuseReason"     column="refuse_reason"    />
        <result property="status"     column="status"    />
        <result property="delFlag"     column="del_flag"    />
        <result property="createTime"     column="create_time"    />
        <result property="createBy"     column="create_by"    />
        <result property="updateTime"     column="update_time"    />
        <result property="updateBy"     column="update_by"    />
        <result property="remark"     column="remark"    />
        <collection  property="lost"   javaType="com.yizhanshi.lost.domain.Lost"  resultMap="LostResult" />
        <collection  property="sysUser"   javaType="com.yizhanshi.system.api.domain.SysUser"  resultMap="UserResult" />
    </resultMap>

    <resultMap type="com.yizhanshi.lost.domain.Lost" id="LostResult">
        <id     property="lostId"       column="lost_id"      />
        <result property="lostName"       column="lost_name"      />
        <result property="lostDescription"     column="lost_description"    />
        <result property="lostPicture"     column="lost_picture"    />
        <result property="lostType"     column="lost_type"    />
        <result property="pickPlace"        column="pick_place"/>
        <result property="pickCampus"        column="pick_campus"/>
        <result property="pickDay"     column="pick_day"    />
        <result property="pickTime"     column="pick_time"    />
        <result property="pickStudentid"     column="pick_studentid"    />
        <result property="pickName"     column="pick_name"    />
        <result property="pickStorePlace"     column="pick_store_place"    />
    </resultMap>
    <resultMap id="UserResult" type="com.yizhanshi.system.api.domain.SysUser">
        <id     property="userId"       column="user_id"        />
        <result property="userStudentid"      column="user_studentid"       />
        <result property="userName"     column="user_name"      />
        <result property="userOrganization"      column="user_organization"       />
        <result property="userCampus"      column="user_campus"       />
        <result property="userEmail"      column="user_email"       />
        <result property="userPhone"      column="user_phone"       />
        <result property="userQq"      column="user_qq"       />
        <result property="userWechat"      column="user_wechat"       />
        <result property="userScore"      column="user_score"       />
    </resultMap>
    <sql id="selectLostApplyVo">
        select la.apply_id,la.apply_name,la.user_studentid,la.apply_content,la.lost_id,la.refuse_reason,
        la.status,la.del_flag,la.create_time,la.create_by,la.update_time,la.update_by,la.remark,
        l.lost_id,l.lost_name,l.lost_description,l.lost_picture,l.lost_type,l.pick_place,l.pick_campus,
        l.pick_day,l.pick_time,l.pick_studentid,l.pick_name,l.pick_studentid,l.pick_name,l.pick_store_place,
        u.user_id,u.user_studentid,u.user_name,u.user_organization,u.user_campus,u.user_email,u.user_phone,u.user_qq,u.user_wechat,u.user_score
        from business_lost_apply la
        left join business_lost l on la.lost_id=l.lost_id
        left join system_user u on u.user_studentid=la.user_studentid
    </sql>
    <select id="selectLostApplyList" parameterType="com.yizhanshi.lost.domain.LostApply" resultMap="LostApplyResult">
        <include refid="selectLostApplyVo"></include>
        where la.del_flag = '0'
        <if test="applyId != null and applyId != 0">
            AND la.apply_id = #{applyId}
        </if>
        <if test="applyName != null and applyName != ''">
            AND la.apply_name = #{applyName}
        </if>
        <if test="userStudentid != null and userStudentid != ''">
            AND la.user_studentid like concat('%', #{userStudentid}, '%')
        </if>
        <if test="lostId != null and lostId != 0">
            AND la.lost_id = #{lostId}
        </if>
        <if test="lost!=null and lost.lostName != null and lost.lostName != ''">
            AND l.lost_name like concat('%', #{lost.lostName}, '%')
        </if>
        <if test="lost!=null and lost.pickCampus != null and lost.pickCampus != ''">
            AND l.pick_campus like concat('%', #{lost.pickCampus}, '%')
        </if>
        <if test="lost!=null and lost.pickStudentid != null and lost.pickStudentid != ''">
            AND l.pick_studentid like concat('%', #{lost.pickStudentid}, '%')
        </if>
        <if test="lost!=null and lost.pickName != null and lost.pickName != ''">
            AND l.pick_name like concat('%', #{lost.pickName}, '%')
        </if>
        <if test="status != null and status !='' ">
            AND la.status = #{status}
        </if>
        <if test="params.beginTime != null and params.beginTime != ''"><!-- 开始时间检索 -->
            AND date_format(la.create_time,'%Y%m%d') &gt;= date_format(#{params.beginTime},'%Y%m%d')
        </if>
        <if test="params.endTime != null and params.endTime != ''"><!-- 结束时间检索 -->
            AND date_format(la.create_time,'%Y%m%d')  &lt;= date_format(#{params.endTime},'%Y%m%d')
        </if>
    </select>
    <select id="selectLostApplyById" parameterType="Long" resultMap="LostApplyResult">
        <include refid="selectLostApplyVo"></include>
        where la.apply_id = #{applyId}
    </select>


    <update id="updateLostApply" parameterType="com.yizhanshi.lost.domain.LostApply">
        update business_lost_apply
        <set>
            <if test="applyName != null and applyName != ''">apply_name=#{applyName},</if>
            <if test="userStudentid != null and userStudentid != ''">user_studentid=#{userStudentid},</if>
            <if test="applyContent != null and applyContent != ''">apply_name=#{applyContent},</if>
            <if test="lostId != null and lostId != 0">lost_id=#{lostId},</if>
            <if test="refuseReason != null and refuseReason != ''">refuse_reason=#{refuseReason},</if>
            <if test="status != null and status != ''">status=#{status},</if>
            <if test="updateBy != null and updateBy != ''">update_by=#{updateBy},</if>
            <if test="remark != null and remark != ''">remark=#{remark},</if>
            update_time = sysdate()
        </set>
        where apply_id = #{applyId}
    </update>
    <delete id="deleteLostApply">
        update business_lost_apply set del_flag = '2' where apply_id in
        <foreach collection="array" item="applyId" open="(" separator="," close=")">
            #{applyId}
        </foreach>
    </delete>
    <insert id="insertLostApply" parameterType="com.yizhanshi.lost.domain.LostApply" useGeneratedKeys="true" keyProperty="applyId">
        insert into business_lost_apply(
        <if test="applyId != null and applyId != 0">apply_id,</if>
        <if test="applyName != null and applyName != ''">apply_name,</if>
        <if test="userStudentid != null and userStudentid != ''">user_studentid,</if>
        <if test="applyContent != null and applyContent != ''">apply_content,</if>
        <if test="lostId != null and lostId != 0">lost_id,</if>
        <if test="refuseReason != null and refuseReason != ''">refuse_reason,</if>
        <if test="status != null and status != ''">status,</if>
        <if test="createBy != null and createBy != ''">create_by,</if>
        <if test="remark != null and remark != ''">remark,</if>
        create_time
        )values(
        <if test="applyId != null and applyId != 0">#{applyId},</if>
        <if test="applyName != null and applyName != ''">#{applyName},</if>
        <if test="userStudentid != null and userStudentid != ''">#{userStudentid},</if>
        <if test="applyContent != null and applyContent != ''">#{applyContent},</if>
        <if test="lostId != null and lostId != 0">#{lostId},</if>
        <if test="refuseReason != null and refuseReason != ''">#{refuseReason},</if>
        <if test="status != null and status != ''">#{status},</if>
        <if test="createBy != null and createBy != ''">#{createBy},</if>
        <if test="remark != null and remark != ''">#{remark},</if>
        sysdate()
        )
    </insert>




</mapper>